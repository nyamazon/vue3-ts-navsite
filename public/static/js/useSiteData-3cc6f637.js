var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,i=(e,t)=>{for(var o in t||(t={}))n.call(t,o)&&s(e,o,t[o]);if(a)for(var o of a(t))l.call(t,o)&&s(e,o,t[o]);return e},r=(e,a)=>t(e,o(a));import{x as c,j as u,y as d,z as g,A as b,B as m,w as v,C as f,e as p,T as h,D as y,n as x,E as _,F as w,G as k,H as $,k as C}from"./index-93166fd7.js";import{u as I,r as O,i as F,a as j,g as L,b as A}from"./base-c3eb4a7a.js";import{u as B,O as P}from"./useHttp-1accd2c3.js";let S;const V=function(e){if(!F)return;const t=E(e);if(t.fullscreen&&S)return S;const o=function(e){let t;const o=I("loading"),a=u(!1),n=d(r(i({},e),{originalPosition:"",originalOverflow:"",visible:!1}));function l(){const e=n.parent;if(!e.vLoadingAddClassList){let t=e.getAttribute("loading-number");t=Number.parseInt(t)-1,t?e.setAttribute("loading-number",t.toString()):(O(e,o.bm("parent","relative")),e.removeAttribute("loading-number")),O(e,o.bm("parent","hidden"))}s(),x.unmount()}function s(){var e,t;null==(t=null==(e=_.$el)?void 0:e.parentNode)||t.removeChild(_.$el)}function y(){a.value&&(a.value=!1,l())}const x=g({name:"ElLoading",setup:()=>()=>{const e=n.spinner||n.svg,t=b("svg",i({class:"circular",viewBox:n.svgViewBox?n.svgViewBox:"25 25 50 50"},e?{innerHTML:e}:{}),[b("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none"})]),a=n.text?b("p",{class:o.b("text")},[n.text]):void 0;return b(h,{name:o.b("fade"),onAfterLeave:y},{default:m((()=>[v(p("div",{style:{backgroundColor:n.background||""},class:[o.b("mask"),n.customClass,n.fullscreen?"is-fullscreen":""]},[b("div",{class:o.b("spinner")},[t,a])]),[[f,n.visible]])]))})}}),_=x.mount(document.createElement("div"));return r(i({},c(n)),{setText:function(e){n.text=e},removeElLoadingChild:s,close:function(){var o;e.beforeClose&&!e.beforeClose()||(n.parent.vLoadingAddClassList=void 0,a.value=!0,clearTimeout(t),t=window.setTimeout((()=>{a.value&&(a.value=!1,l())}),400),n.visible=!1,null==(o=e.closed)||o.call(e))},handleAfterLeave:y,vm:_,get $el(){return _.$el}})}(r(i({},t),{closed:()=>{var e;null==(e=t.closed)||e.call(t),t.fullscreen&&(S=void 0)}}));N(t,t.parent,o),T(t,t.parent,o),t.parent.vLoadingAddClassList=()=>T(t,t.parent,o);let a=t.parent.getAttribute("loading-number");return a=a?`${Number.parseInt(a)+1}`:"1",t.parent.setAttribute("loading-number",a),t.parent.appendChild(o.$el),y((()=>o.visible.value=t.visible)),t.fullscreen&&(S=o),o},E=e=>{var t,o,a,n;let l;return l=x(e.target)?null!=(t=document.querySelector(e.target))?t:document.body:e.target||document.body,{parent:l===document.body||e.body?document.body:l,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:l===document.body&&(null==(o=e.fullscreen)||o),lock:null!=(a=e.lock)&&a,customClass:e.customClass||"",visible:null==(n=e.visible)||n,target:l}},N=async(e,t,o)=>{const{nextZIndex:a}=j(),n={};if(e.fullscreen)o.originalPosition.value=L(document.body,"position"),o.originalOverflow.value=L(document.body,"overflow"),n.zIndex=a();else if(e.parent===document.body){o.originalPosition.value=L(document.body,"position"),await y();for(const t of["top","left"]){const o="top"===t?"scrollTop":"scrollLeft";n[t]=e.target.getBoundingClientRect()[t]+document.body[o]+document.documentElement[o]-Number.parseInt(L(document.body,`margin-${t}`),10)+"px"}for(const t of["height","width"])n[t]=`${e.target.getBoundingClientRect()[t]}px`}else o.originalPosition.value=L(t,"position");for(const[l,s]of Object.entries(n))o.$el.style[l]=s},T=(e,t,o)=>{const a=I("loading");"absolute"!==o.originalPosition.value&&"fixed"!==o.originalPosition.value?A(t,a.bm("parent","relative")):O(t,a.bm("parent","relative")),e.fullscreen&&e.lock?A(t,a.bm("parent","hidden")):O(t,a.bm("parent","hidden"))},D=Symbol("ElLoading"),z=(e,t)=>{var o,a,n,l;const s=t.instance,i=e=>_(t.value)?t.value[e]:void 0,r=t=>(e=>{const t=x(e)&&(null==s?void 0:s[e])||e;return t?u(t):t})(i(t)||e.getAttribute(`element-loading-${w(t)}`)),c=null!=(o=i("fullscreen"))?o:t.modifiers.fullscreen,d={text:r("text"),svg:r("svg"),svgViewBox:r("svgViewBox"),spinner:r("spinner"),background:r("background"),customClass:r("customClass"),fullscreen:c,target:null!=(a=i("target"))?a:c?void 0:e,body:null!=(n=i("body"))?n:t.modifiers.body,lock:null!=(l=i("lock"))?l:t.modifiers.lock};e[D]={options:d,instance:V(d)}},H={mounted(e,t){t.value&&z(e,t)},updated(e,t){const o=e[D];t.oldValue!==t.value&&(t.value&&!t.oldValue?z(e,t):t.value&&t.oldValue?_(t.value)&&((e,t)=>{for(const o of Object.keys(t))k(t[o])&&(t[o].value=e[o])})(t.value,o.options):null==o||o.instance.close())},unmounted(e){var t;null==(t=e[D])||t.instance.close()}};const J=()=>({setItem:(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},getItem:(e,t)=>{const o=localStorage.getItem(e);if(!o)return t;try{return JSON.parse(o)}catch(a){return t}},delItem:e=>{localStorage.removeItem(e)}}),{setItem:R}=J(),G=$({id:"site-settings",state:()=>({user_id:1,suffix:"233",theme:"classic",icon_url:"//at.alicdn.com/t/font_2331429_8wodx9zja84.css",site_name:"二进制术士",other_background_image:"",site_desc:"dont look back in angle",site_back_animation:"startDot",background_image:"https://ae01.alicdn.com/kf/Uc3d8f541d57e48c9a270407d96334ef7G.jpg",background_color:"rgba(3, 7, 8, 0.68)",pure_background:!1,background_music:"https://music.163.com/song/media/outer/url?id=1331962874.mp3",box_link_align:"center",site_name_color:"#F7F7F7",box_background_color:"rgba(14, 14, 14, 0.24)",box_title_color:"#FFFFFF",box_link_color:"#FFFFFF",box_link_hover_color:"#E47116",box_back_hover_color:"rgba(0, 0, 0, 0.55)",bg_mask_color:"rgba(0, 0, 0, 0.04)",site_notice:""}),actions:{load(e){this.$patch(i({},e))}}}),U=G();U.$subscribe(((e,t)=>{console.log("sub",t),R(U.$id,i({},t))}));const q=()=>{const e=u(!0),t=u({}),o=u([]);return B({url:"webmain",method:"get"}).then((({data:e,code:a})=>{console.log(e,"data"),a===P&&(t.value=e.site_config,o.value=e.search_config)})).finally((()=>e.value=!1)),{siteConfig:t,searchConfig:o,loading:e}},M=e=>{const t=u([]),o=u(!1);C(e,(async()=>{console.log("userID",e.value),await a()}));const a=async()=>{if(o.value=!0,!e.value||e.value<=0)return;let{code:a,data:n}=await(e.value,B({url:"webmain/links",method:"get"}));o.value=!1,a===P&&(t.value=n)};return{loading:o,refresh:a,boxes:t}},Z=$({id:"search-config",state:()=>({data:[]}),actions:{load(e){this.$patch({data:e})}}}),K=$({id:"weather",state:()=>({city:"佛山",data:{}}),actions:{changeCity(e){this.$state.city=e}}}),Q=K(),{setItem:W,getItem:X}=J();Q.$subscribe(((e,t)=>{W(Q.$id,i({},t))}));const Y=X(Q.$id);Q.$patch(i({},Y));const ee=()=>{const e=K(),t=u(""),o=u();return C((()=>e.city),(e=>{e&&(e=>B({url:`common/weather?city=${encodeURIComponent(e)}`,method:"get"}))(e).then((({data:e})=>{t.value=e;try{o.value=JSON.parse(e),console.log(o.value)}catch(a){}}))}),{immediate:!0}),{weather:o,rawData:t}},te=$({id:"news",state:()=>({data:[]}),actions:{updateNews(e){this.$state.data=e}}}),oe=te(),{setItem:ae,getItem:ne}=J();oe.$subscribe(((e,t)=>{ae(oe.$id,i({},t))}));const le=ne(oe.$id);oe.$patch(i({},le));const se=()=>{const e=u([]),t=u(!1),o=()=>{t.value=!0,B({url:"common/news",method:"get"}).then((({code:t,data:o})=>{t===P&&(e.value=o)})).finally((()=>{t.value=!1}))};return o(),{news:e,refresh:o,loading:t}},ie=()=>{const{siteConfig:e,loading:t,searchConfig:o}=q(),a=u(-1),n=G(),l=Z(),s=K(),i=te();C((()=>e.value.id),(t=>{!t||t<=0||(a.value=t,n.load(e.value),l.load(o.value))}));const{boxes:r,loading:c}=M(a),{weather:d}=ee(),{news:g}=se();return C(d,(()=>{s.$patch({data:d.value})})),C(g,(()=>{i.$patch({data:g.value})})),{siteConfig:e,boxes:r,loadingSiteConfig:t,loadingBoxes:c}};export{G as a,Z as b,se as c,K as d,ie as u,H as v};
